services:
  # ---------------------------------------------------------------------------
  # Production Service (Nginx)
  # Usage: docker compose --profile prod up
  # ---------------------------------------------------------------------------
  web:
    profiles: ["prod"]
    container_name: portfolio-prod
    build:
      context: .
      dockerfile: Dockerfile
    image: docker.io/maniesh22/manish:test
    ports:
      - "${PROD_PORT:-8080}:80"
    restart: unless-stopped
    environment:
      - NODE_ENV=production

  # ---------------------------------------------------------------------------
  # Development Service (Vite HMR)
  # Usage: docker compose --profile dev up
  # ---------------------------------------------------------------------------
  dev:
    profiles: ["dev"]
    container_name: portfolio-dev
    image: node:18-alpine
    working_dir: /app
    # FIX: Always run install to ensure vite exists
    command: sh -c "npm install && npm run dev -- --host 0.0.0.0"
    volumes:
      - ./:/app:cached         # Mount current directory
      - /app/node_modules      # Keep node_modules inside container
    ports:
      - "${DEV_PORT:-5173}:5173"
    environment:
      - CHOKIDAR_USEPOLLING=true
      - VITE_PORT=5173
